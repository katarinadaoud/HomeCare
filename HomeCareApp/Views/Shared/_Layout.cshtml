@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery

@{
    // Rolle
    var role = (string?) (ViewBag.Role ?? ViewData["Role"]) ?? "public"; // public | patient | employee
    var showSOS    = role == "patient";
    var showToasts = role != "public";

    // Hvilken side
    var ctrl  = (string?)ViewContext.RouteData.Values["Controller"];
    var act   = (string?)ViewContext.RouteData.Values["Action"];
    var isHome = string.Equals(ctrl, "Home", StringComparison.OrdinalIgnoreCase)
              && string.Equals(act,  "Index", StringComparison.OrdinalIgnoreCase);

    // Pasient-ID fra controller (hvis satt)
    int? pid = ViewBag.PatientId as int?;
}

<!doctype html>
<html lang="nb">
<head>
    <meta charset="utf-8" />
    <meta name="request-verification-token" content="@Antiforgery.GetTokens(Context).RequestToken" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light" />
    <meta name="theme-color" content="#2F6CAB" />
    <title>@ViewData["Title"] - LifeLink</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;800;900&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" />

    <link rel="stylesheet" href="~/css/00-tokens.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/01-base.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/02-layout.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/03-components.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/04-utilities.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/page-calendar.css" asp-append-version="true" />

    @RenderSection("Styles", required: false)
</head>
<body class="bg-light" data-role="@role">

    @if (role == "patient")
    {
        @await Html.PartialAsync("TopNav/_Patient")
    }
    else if (role == "employee")
    {
        @await Html.PartialAsync("TopNav/_Employee")
    }
    else if (!isHome)
    {
        @await Html.PartialAsync("TopNav/_Public")
    }

    <main style="margin-top: 70px;">
        @RenderBody()
    </main>

    @if (showToasts)
    {
        @await Html.PartialAsync("_Toasts")
    }
    @if (showSOS)
    {
        @await Html.PartialAsync("_SosConfirmModal")
    }

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>

    <script>window.AppRole = "@role";</script>
    @if (role == "patient" && pid.HasValue)
    {
        <script>window.AppPatientId = @pid.Value;</script>
    }

    <script src="~/js/app.js" asp-append-version="true"></script>

    @RenderSection("Scripts", required: false)
</body>
</html>
